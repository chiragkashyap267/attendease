<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="rythm.png">
    <meta name="theme-color" content="#1e293b">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Attendance Tracker</title>
    <!-- PWA Manifest and Theme Color -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom radio button styles */
        .custom-radio input[type="radio"] {
            display: none;
        }
        .custom-radio label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
            white-space: nowrap;
            border: 1px solid transparent;
        }
        .custom-radio input[type="radio"]:checked + label {
            color: white;
            transform: scale(1.05);
        }
        .present-radio:checked + label { background-color: #22c55e; border-color: #22c55e; } /* green-500 */
        .absent-radio:checked + label { background-color: #ef4444; border-color: #ef4444; } /* red-500 */
        .leave-radio:checked + label { background-color: #f97316; border-color: #f97316; } /* orange-500 */

        .present-radio + label { border-color: #d1d5db; color: #374151; }
        .absent-radio + label { border-color: #d1d5db; color: #374151; }
        .leave-radio + label { border-color: #d1d5db; color: #374151; }
        
        .present-radio:hover + label { background-color: #dcfce7; }
        .absent-radio:hover + label { background-color: #fee2e2; }
        .leave-radio:hover + label { background-color: #ffedd5; }
    </style>
</head>
<body class="bg-slate-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden">
        <!-- Header Section -->
        <div class="bg-slate-800 text-white p-6 md:p-8 flex items-center justify-between">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold">AttendEASE</h1>
                <p class="text-slate-300 mt-1">Modern Attendance Tracking</p>
                <p>by chirag kashyap rajput </p>
            </div>
             <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-slate-500 hidden sm:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
            </svg>
        </div>

        <div class="p-6 md:p-8">
            <!-- Class Details Form -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div>
                    <label for="classSelector" class="block text-sm font-medium text-gray-700 mb-1">Select Class</label>
                    <select id="classSelector" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        <option value="MCA 3RD SEM">MCA 3RD SEM</option>
                        <option value="MCA 1ST SEM">MCA 1ST SEM</option>
                    </select>
                </div>
                 <div>
                    <label for="subjectSelector" class="block text-sm font-medium text-gray-700 mb-1">Select Subject</label>
                    <select id="subjectSelector" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        <!-- Subject options will be populated by JS -->
                    </select>
                </div>
                <div>
                    <label for="attendanceDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="attendanceDate" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                </div>
            </div>

            <!-- Student List -->
            <div id="studentList" class="space-y-3 mb-8">
                <!-- Student rows will be injected here -->
                <p class="text-center text-gray-500" id="empty-state" style="display: none;">No students to display.</p>
            </div>

            <!-- Submit Button -->
            <div class="text-center mt-10">
                <button id="submitAttendanceBtn" class="w-full md:w-2/3 bg-gradient-to-r from-indigo-600 to-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:from-indigo-700 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 shadow-lg hover:shadow-xl text-lg transform hover:scale-105">
                    Generate Attendance PDF
                </button>
            </div>
        </div>
    </main>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            const studentList = document.getElementById('studentList');
            const submitAttendanceBtn = document.getElementById('submitAttendanceBtn');
            const classSelector = document.getElementById('classSelector');
            const subjectSelector = document.getElementById('subjectSelector');
            const attendanceDateInput = document.getElementById('attendanceDate');
            const emptyState = document.getElementById('empty-state');

            let studentCount = 0;

            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            attendanceDateInput.value = `${year}-${month}-${day}`;
            
            const students3rdSem = { "ALOK NEGI": 2405001, "AMAN POKHRIYAL": 2405002, "ANAS SAIFI": 2405003, "ANJALI GUSAIN": 2405004, "ANJALI PATWAL": 2405005, "ASMIT BHATT": 2405006, "AYUSH MAURYA": 2405007, "AYUSH RAWAT": 2405008, "CHIRAG KASHYAP": 2405009, "DEVENDRA SINGH RANA": 2405010, "DIKSHA PHARTYAL": 2405011, "KAMAL SINGH BISHT": 2405012, "KRISHNA BHATT": 2405013, "MANSI SAINI": 2405014, "MANVI UNIYAL": 2405015, "NEERAJ JOSHI": 2405016, "PRIYANSHU BHATT": 2405017, "PRIYANSHU DHYANI": 2405018, "SEJAL SINGH": 2405019, "SHARAD NIJWALA": 2405020, "SHIKHA": 2405021, "SHIVANI BHATT": 2405022, "SHRIYANSHU DHYANI": 2405023, "SIDDHARTH PATWAL": 2405024, "SURAJ SINGH BISHT": 2405025 };
            const students1stSem = { "ABHISHEK RAWAT": 2505001, "ABHISHEK SINGH NAYAL": 2505002, "ASHOK CHANDRA UPRETI": 2505003, "AYUSH SINGH RAWAT": 2505004, "DEEPAK BISHT": 2505005, "DEVASHISH TIWARI": 2505006, "DIVESH PANT": 2505007, "KHUSHI DWIVEDI": 2505008, "KIRAN SAHANI": 2505009, "NIKITA BALODHI": 2505010, "NISHTHA ARORA": 2505011, "OJASWEE BISHT": 2505012, "RATNESH JUYAL": 2505013, "REETU SAINI": 2505014, "RISHABH KAINTURA": 2505015, "ROHIT SINGH": 2505016, "SAURAV DHAPOLA": 2505017, "SHIVANK RAWAT": 2505018, "SIMRAN KANDARI": 2505019, "VIVEK": 2505020 };

            const subjects = {
                "MCA 3RD SEM": ["Big Data Analysis", "Entrepreneurship", "Minor Project", "Seminar", "Graph Theory", "Universal Human Values"],
                "MCA 1ST SEM": ["Computer Organization", "Python Programming", "Discrete Mathematics", "Operating System", "Technical Communication Skills", "Web Technology (Bridge)", "Programming in C (Bridge)", "Information Technology (Bridge)"]
            };

            const addStudent = (name, id) => {
                studentCount++;
                const studentId = `student-${Date.now()}-${studentCount}`; 
                const studentRow = document.createElement('div');
                studentRow.className = 'student-row flex flex-col sm:flex-row items-center justify-between p-3 border border-slate-200 rounded-lg transform transition-all duration-200 hover:shadow-md hover:border-slate-300 hover:scale-[1.02] gap-4';
                studentRow.innerHTML = `
                    <div class="flex items-center gap-3 flex-grow w-full">
                        <span class="serial-number text-sm font-bold text-slate-500 w-6 text-center">${studentCount}.</span>
                        <span class="student-id font-mono text-sm text-slate-600">${id}</span>
                        <p class="font-medium text-lg flex-grow text-slate-900">${name}</p>
                    </div>
                    <div class="flex items-center space-x-2 custom-radio flex-shrink-0">
                        <input type="radio" id="present-${studentId}" name="status-${studentId}" value="Present" class="present-radio" checked>
                        <label for="present-${studentId}">Present</label>

                        <input type="radio" id="absent-${studentId}" name="status-${studentId}" value="Absent" class="absent-radio">
                        <label for="absent-${studentId}">Absent</label>
                        
                        <input type="radio" id="leave-${studentId}" name="status-${studentId}" value="Leave" class="leave-radio">
                        <label for="leave-${studentId}">Leave</label>
                    </div>
                `;
                studentList.appendChild(studentRow);
            };
            
            const renderStudentList = (selectedClass) => {
                studentList.innerHTML = '';
                studentCount = 0;
                let studentsToRender = selectedClass === "MCA 3RD SEM" ? students3rdSem : students1stSem;
                if (studentsToRender && Object.keys(studentsToRender).length > 0) {
                    if(emptyState) emptyState.style.display = 'none';
                    for (const [name, id] of Object.entries(studentsToRender)) { addStudent(name, id); }
                } else {
                    if(emptyState) emptyState.style.display = 'block';
                }
            };

            const renderSubjectList = (selectedClass) => {
                subjectSelector.innerHTML = '';
                const subjectList = subjects[selectedClass] || [];
                subjectList.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelector.appendChild(option);
                });
            };
            
            classSelector.addEventListener('change', (e) => {
                renderStudentList(e.target.value);
                renderSubjectList(e.target.value);
            });
            
            // Initial render on page load
            renderStudentList(classSelector.value);
            renderSubjectList(classSelector.value);

            submitAttendanceBtn.addEventListener('click', () => {
                const className = classSelector.value;
                const subjectName = subjectSelector.value;
                const attendanceDate = attendanceDateInput.value;

                if (!subjectName) {
                    alert('Please select a subject.');
                    return;
                }
                if (studentList.querySelectorAll('.student-row').length === 0) {
                    alert('There are no students in the list.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const reportTime = new Date().toLocaleTimeString();
                
                doc.setFontSize(20);
                doc.text('Attendance Report', 14, 22);
                doc.setFontSize(12);
                doc.text(`Class: ${className}`, 14, 32);
                doc.text(`Subject: ${subjectName}`, 14, 40);
                doc.text(`Date: ${new Date(attendanceDate).toLocaleDateString()}`, 14, 48);
                doc.text(`Time Generated: ${reportTime}`, 14, 56);

                const tableHead = [['S.No.', 'Institute ID', 'Student Name', 'Status']];
                const tableBody = [];
                const studentRows = studentList.querySelectorAll('.student-row');
                
                let presentCount = 0, absentCount = 0, leaveCount = 0;

                studentRows.forEach((row, index) => {
                    const id = row.querySelector('.student-id').innerText;
                    const name = row.querySelector('p').innerText;
                    const status = row.querySelector('input[type="radio"]:checked').value;
                    tableBody.push([index + 1, id, name, status]);

                    if (status === 'Present') presentCount++;
                    else if (status === 'Absent') absentCount++;
                    else if (status === 'Leave') leaveCount++;
                });

                doc.autoTable({
                    head: tableHead,
                    body: tableBody,
                    startY: 68,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 41, 59] }, // slate-800
                });

                let finalY = doc.autoTable.previous.finalY;
                doc.setFontSize(14);
                doc.text('Summary', 14, finalY + 15);
                doc.setFontSize(12);
                doc.text(`Total Students: ${studentRows.length}`, 14, finalY + 22);
                doc.setTextColor(34, 197, 94); // green-500
                doc.text(`Present: ${presentCount}`, 14, finalY + 29);
                doc.setTextColor(239, 68, 68); // red-500
                doc.text(`Absent: ${absentCount}`, 14, finalY + 36);
                doc.setTextColor(249, 115, 22); // orange-500
                doc.text(`On Leave: ${leaveCount}`, 14, finalY + 43);
                
                doc.setTextColor(0, 0, 0);

                doc.save(`Attendance_${className.replace(/\s/g, '_')}_${subjectName.replace(/\s/g, '_')}_${attendanceDate}.pdf`);
            });
        });
    </script>
</body>
</html>


